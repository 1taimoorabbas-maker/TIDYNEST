---
import siteData from '../data/site.json';
import { amazonUrlFromAsin, productImagePath, getBadgeInfo } from '../lib/helpers';

interface Props {
  product: {
    title: string;
    slug: string;
    asin: string;
    shortDescription: string;
    badge?: string;
    bullets: string[];
    alt: string;
  };
  variant?: 'default' | 'featured' | 'compact';
}

const { product, variant = 'default' } = Astro.props;
const affiliateUrl = amazonUrlFromAsin(product.asin);
const imagePath = productImagePath(product.slug);
const badgeInfo = product.badge ? getBadgeInfo(product.badge) : null;
---

<div class:list={[
  "bg-white rounded-xl border shadow-sm overflow-hidden",
  variant === 'featured' ? 'border-[#5e6d50] border-2' : 'border-stone-200'
]}>
  {variant === 'featured' && (
    <div class="bg-[#5e6d50] text-white text-center py-2 text-sm font-medium">
      ‚≠ê Our Top Recommendation
    </div>
  )}
  
  <div class="p-4 lg:p-6">
    <div class="flex flex-col md:flex-row gap-4 lg:gap-6">
      <!-- Image -->
      <div class="w-full md:w-48 lg:w-56 flex-shrink-0">
        <a href={`/product/${product.slug}/`} class="block relative aspect-square rounded-lg overflow-hidden bg-stone-100">
          <img 
            src={imagePath}
            alt={product.alt}
            class="w-full h-full object-cover"
            loading="lazy"
            onerror="this.onerror=null; this.src='/images/placeholder-product.svg';"
          >
          {badgeInfo && (
            <span class={`absolute top-2 left-2 ${badgeInfo.color} text-white text-xs font-semibold px-2 py-0.5 rounded-full`}>
              {badgeInfo.label}
            </span>
          )}
        </a>
      </div>
      
      <!-- Content -->
      <div class="flex-grow">
        <a href={`/product/${product.slug}/`}>
          <h4 class="font-serif text-lg lg:text-xl font-semibold text-stone-800 hover:text-[#5e6d50] transition-colors mb-2">
            {product.title}
          </h4>
        </a>
        
        <p class="text-stone-600 text-sm mb-4">
          {product.shortDescription}
        </p>
        
        {variant !== 'compact' && (
          <ul class="space-y-1.5 mb-4">
            {product.bullets.slice(0, 4).map(bullet => (
              <li class="flex items-start text-sm text-stone-600">
                <svg class="w-4 h-4 text-[#5e6d50] mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                <span>{bullet}</span>
              </li>
            ))}
          </ul>
        )}
        
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
          <a 
            href={affiliateUrl}
            target="_blank"
            rel="nofollow sponsored noopener"
            class="inline-flex items-center justify-center bg-[#5e6d50] hover:bg-[#4a5641] text-white font-medium py-2.5 px-6 rounded-lg transition-colors text-sm"
          >
            Check Price on Amazon
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
          <span class="text-xs text-stone-400">*Affiliate link</span>
        </div>
      </div>
    </div>
  </div>
</div>
