---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProductCard from '../../components/ProductCard.astro';
import GuideCard from '../../components/GuideCard.astro';
import siteData from '../../data/site.json';
import categoriesData from '../../data/categories.json';
import productsData from '../../data/products.json';
import guidesData from '../../data/guides.json';
import { getProductsByCategory, getGuidesByCategory, getCategoryIcon } from '../../lib/helpers';

export function getStaticPaths() {
  const { categories } = categoriesData;

  return categories.map((category) => ({
    params: { slug: category.slug },
    props: { category }
  }));
}

const { category } = Astro.props;
const { products } = productsData;
const { guides } = guidesData;

const categoryProducts = getProductsByCategory(products, category.slug);
const categoryGuides = getGuidesByCategory(guides, category.slug);
const iconSvg = getCategoryIcon(category.icon);

const title = `${category.title} - ${siteData.siteName}`;
const description = category.description;
const pathname = `/category/${category.slug}/`;
const ogImage = `/images/categories/${category.slug}.jpg`;
---

<BaseLayout title={title} description={description} pathname={pathname} ogImage={ogImage} ogType="website">
  <!-- Category Hero -->
  <section class="relative bg-gradient-to-br from-[color:var(--color-sage-50)] via-white to-[color:var(--color-sage-100)] py-12 lg:py-20 overflow-hidden">
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-10 right-10 w-72 h-72 bg-[color:var(--color-sage-700)] rounded-full blur-3xl"></div>
      <div class="absolute bottom-10 left-10 w-96 h-96 bg-[color:var(--color-sage-500)] rounded-full blur-3xl"></div>
    </div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex items-center text-sm text-stone-500 mb-6">
        <a href="/" class="hover:text-[color:var(--color-sage-700)] transition-colors">Home</a>
        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <a href="/categories/" class="hover:text-[color:var(--color-sage-700)] transition-colors">Categories</a>
        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-stone-800">{category.title}</span>
      </nav>

      <div class="grid lg:grid-cols-2 gap-8 items-center">
        <div>
          <div class="flex items-center gap-4 mb-4">
            <div class="w-14 h-14 bg-[color:var(--color-sage-700)]/10 rounded-xl flex items-center justify-center text-[color:var(--color-sage-700)]">
              <Fragment set:html={iconSvg} />
            </div>

            <span class="bg-[color:var(--color-sage-700)]/10 text-[color:var(--color-sage-700)] text-sm font-medium px-3 py-1 rounded-full">
              {categoryProducts.length} Products
            </span>
          </div>

          <h1 class="font-serif text-3xl sm:text-4xl lg:text-5xl font-bold text-stone-800 mb-4">
            {category.title}
          </h1>

          <p class="text-lg text-stone-600 mb-6">{category.description}</p>

          <div class="flex flex-wrap gap-3">
            <a
              href="#products"
              class="inline-flex items-center bg-[color:var(--color-sage-700)] hover:bg-[color:var(--color-sage-800)] text-white font-semibold py-3 px-6 rounded-xl transition-colors"
            >
              Browse Products
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </a>

            {categoryGuides.length > 0 && (
              <a
                href="#guides"
                class="inline-flex items-center bg-white hover:bg-stone-50 text-stone-700 font-semibold py-3 px-6 rounded-xl transition-colors border border-stone-200"
              >
                Read Guides
              </a>
            )}
          </div>
        </div>

        <div class="relative hidden lg:block">
          <div class="aspect-[4/3] rounded-2xl overflow-hidden shadow-2xl">
            <img
              src={`/images/categories/${category.slug}.jpg`}
              alt={category.title}
              class="w-full h-full object-cover"
              onerror="this.onerror=null; this.src='/images/placeholder-category.svg';"
            />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SEO Content Block -->
  <section class="py-10 bg-white border-b border-[color:var(--color-sage-200)]">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="prose prose-stone max-w-none">
        <p class="text-stone-600 leading-relaxed">
          Looking for the best {category.title.toLowerCase()} solutions? We've researched and tested dozens of products to bring you our top picks. Whether you're starting from scratch or upgrading your current setup, our curated selection helps you create an organized, beautiful space that makes everyday life easier.
        </p>
      </div>
    </div>
  </section>

  <!-- Guides Section -->
  {categoryGuides.length > 0 && (
    <section id="guides" class="py-12 lg:py-16 bg-[color:var(--color-sage-50)] scroll-mt-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-10">
          <span class="inline-block bg-[color:var(--color-sage-700)]/10 text-[color:var(--color-sage-700)] text-sm font-medium px-4 py-1.5 rounded-full mb-4">
            Expert Advice
          </span>

          <h2 class="font-serif text-2xl lg:text-3xl font-bold text-stone-800 mb-3">
            {category.title} Guides
          </h2>

          <p class="text-stone-600 max-w-xl mx-auto">Step-by-step guides to help you get organized</p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {categoryGuides.map((guide) => (
            <GuideCard guide={guide} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Products Section -->
  <section id="products" class="py-12 lg:py-16 bg-white scroll-mt-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-10">
        <h2 class="font-serif text-2xl lg:text-3xl font-bold text-stone-800 mb-3">
          Top {category.title} Products
        </h2>
        <p class="text-stone-600 max-w-xl mx-auto">
          Our expert-curated picks for organizing your {category.title.toLowerCase().replace(' organization', '')}
        </p>
      </div>

      <!-- Filter by Badge (kept, but recolored to match theme) -->
      <div class="flex flex-wrap justify-center gap-2 mb-8">
        <span class="px-4 py-2 bg-[color:var(--color-sage-100)] text-[color:var(--color-sage-800)] text-sm font-medium rounded-full">
          Top Picks
        </span>
        <span class="px-4 py-2 bg-[color:var(--color-sage-200)] text-[color:var(--color-sage-800)] text-sm font-medium rounded-full">
          Budget Friendly
        </span>
        <span class="px-4 py-2 bg-[color:var(--color-sage-300)] text-[color:var(--color-sage-900)] text-sm font-medium rounded-full">
          Premium Choice
        </span>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-6">
        {categoryProducts.map((product) => (
          <ProductCard product={product} />
        ))}
      </div>

      {categoryProducts.length === 0 && (
        <div class="text-center py-12">
          <p class="text-stone-500">No products in this category yet. Check back soon!</p>
        </div>
      )}
    </div>
  </section>

  <!-- Category Tips -->
  <section class="py-12 lg:py-16 bg-gradient-to-br from-[color:var(--color-sage-700)] to-[color:var(--color-sage-800)] text-white">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="font-serif text-2xl lg:text-3xl font-bold mb-4">
        Quick {category.title} Tips
      </h2>

      <div class="grid sm:grid-cols-3 gap-6 mt-8">
        <div class="bg-white/10 rounded-xl p-6">
          <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center mx-auto mb-4">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <h3 class="font-semibold mb-2">Take Inventory</h3>
          <p class="text-white/70 text-sm">Start by emptying everything and sorting into categories</p>
        </div>

        <div class="bg-white/10 rounded-xl p-6">
          <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center mx-auto mb-4">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </div>
          <h3 class="font-semibold mb-2">Declutter First</h3>
          <p class="text-white/70 text-sm">Donate or discard items you no longer use or need</p>
        </div>

        <div class="bg-white/10 rounded-xl p-6">
          <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center mx-auto mb-4">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
            </svg>
          </div>
          <h3 class="font-semibold mb-2">Zone It Out</h3>
          <p class="text-white/70 text-sm">Create dedicated zones for different activities or items</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Browse Other Categories -->
  <section class="py-12 lg:py-16 bg-[color:var(--color-sage-50)]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="font-serif text-2xl font-bold text-stone-800 text-center mb-8">
        Explore Other Categories
      </h2>

      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {categoriesData.categories.filter((c) => c.slug !== category.slug).map((cat) => (
          <a
            href={`/category/${cat.slug}/`}
            class="group bg-white rounded-xl p-4 border border-stone-200 hover:border-[color:var(--color-sage-700)] hover:shadow-md transition-all"
          >
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-[color:var(--color-sage-700)]/10 rounded-lg flex items-center justify-center text-[color:var(--color-sage-700)] group-hover:bg-[color:var(--color-sage-700)] group-hover:text-white transition-colors">
                <Fragment set:html={getCategoryIcon(cat.icon)} />
              </div>
              <span class="font-medium text-stone-700 group-hover:text-[color:var(--color-sage-700)] transition-colors">
                {cat.title}
              </span>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>